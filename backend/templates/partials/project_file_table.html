<!-- Uploaded Project Files Table -->
<div x-data="{
    files: [],
    filter: 'All',
    fetchFiles() {
      fetch(`/project/{{ project_slug }}/files`)
        .then(res => res.json())
        .then(data => this.files = data);
    },
    deleteFile(filename, button) {
      if (!confirm(`Are you sure you want to delete '${filename}'?`)) return;
      button.innerHTML = '<span class=\'animate-spin h-4 w-4 border-2 border-current border-t-transparent rounded-full\'></span>';
      fetch(`/project/{{ project_slug }}/delete-file`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ filename })
      })
      .then(res => res.ok ? this.fetchFiles() : alert('Error deleting file'))
      .catch(() => alert('Error deleting file'));
    }
  }" x-init="fetchFiles()" class="mt-8">
  
    <!-- Filter Tabs -->
    <div class="flex gap-2 mb-4 text-sm font-medium">
      <template x-for="type in ['All', 'Site Notes', 'Gap Analysis', 'Recommendations', 'Template']" :key="type">
        <button
          @click="filter = type"
          class="px-3 py-1 rounded-full"
          :class="filter === type ? 'bg-black text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
          x-text="type"
        ></button>
      </template>
    </div>
  
    <!-- Table -->
    <div class="overflow-auto rounded-lg shadow border border-gray-200 bg-white">
      <table class="min-w-full text-sm">
        <thead class="bg-gray-50 text-left text-gray-600 uppercase text-xs">
          <tr>
            <th class="px-4 py-2 font-medium">File Name</th>
            <th class="px-4 py-2 font-medium">Category</th>
            <th class="px-4 py-2 font-medium">Size</th>
            <th class="px-4 py-2 font-medium">Uploaded</th>
            <th class="px-4 py-2 font-medium">Actions</th>
          </tr>
        </thead>
        <tbody>
          <template x-for="file in files.filter(f => filter === 'All' || f.category === filter)" :key="file.filename">
            <tr class="border-t">
              <td class="px-4 py-2 text-gray-800" x-text="file.filename"></td>
              <td class="px-4 py-2 text-gray-600" x-text="file.category"></td>
              <td class="px-4 py-2 text-gray-600" x-text="file.size_kb + ' KB'"></td>
              <td class="px-4 py-2 text-gray-600" x-text="new Date(file.uploaded_at).toLocaleString()"></td>
              <td class="px-4 py-2 flex gap-3 items-center">
                <!-- View Icon -->
                <a :href="`/project/{{ project_slug }}/files/${file.filename}`"
                   target="_blank"
                   class="text-gray-500 hover:text-gray-700"
                   title="View">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                </a>
              
                <!-- Delete Icon -->
                <button @click="deleteFile(file.filename, $event.target)"
                        class="text-red-500 hover:text-red-700"
                        title="Delete">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6m5 0V4a2 2 0 012-2h2a2 2 0 012 2v2"/>
                    <line x1="10" y1="11" x2="10" y2="17"/>
                    <line x1="14" y1="11" x2="14" y2="17"/>
                  </svg>
                </button>
              </td>
              
            </tr>
          </template>
        </tbody>
      </table>
    </div>
  </div>
  