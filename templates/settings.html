<!--
==============================================
 Settings Page - Functional Requirements
==============================================

GENERAL:
- Page displays configurable options for the LLM Assistant
- Form saves settings to config.json via POST request
- Bootstrap 5 used for layout and components

MODEL SETTINGS:
- Allowed Text Models (multi-select checkboxes): llama, mistral, phi
- Default Text Model (dropdown): must be one of the allowed models
- Allowed Image Models (multi-select checkboxes): bakllava, llava-llama3
- Default Image Model (dropdown): must be one of the allowed image models

UPLOAD SETTINGS:
- Max Upload File Size: dropdown with values [5, 10, 15, 20, 25, 50] MB
- Allowed File Extensions for Text Analysis: read-only list (from backend ALLOWED_EXTENSIONS)
- Allowed File Extensions for Image Analysis: read-only list (subset of extensions for images)

RESPONSE HANDLING:
- Enable Cache: On/Off toggle (controls query cache behavior)
- Enable Streaming: On/Off toggle (enables streaming of model responses)

UI BEHAVIOR:
- Lock Prompt During Model Run: On/Off toggle (disables prompt input during execution)

BACKLOG (Not Implemented Yet):
- Execution Mode: Sequential vs Concurrent
- Max Models to Run in Parallel (if concurrency is enabled)
- Show/Hide System Messages (e.g., debug logs)
- Enable/Disable Statistics Logging
- Export Statistics to CSV
- Reset All Stats

==============================================
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Settings - LLM Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container-fluid">
  <div class="row">

    <!-- Sidebar -->
    <div class="col-12 col-md-3 col-lg-2 p-0 border-end bg-light">
      {% include 'navbar.html' %}
    </div>

    <!-- Main Content -->
    <div class="col-12 col-md-9 col-lg-10 p-4">
      <h1 class="mb-4">‚öôÔ∏è Settings</h1>

      <form method="POST">

        <!-- Text Models -->
        <div class="card mb-4">
          <div class="card-header">Text Model Settings</div>
          <div class="card-body">

            <div class="mb-3">
              <label class="form-label">Allowed Text Models:</label>
              {% for model in all_text_models %}
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" name="allowed_text_models"
                         value="{{ model }}" id="text-{{ model }}"
                         {% if model in config.allowed_text_models %}checked{% endif %}>
                  <label class="form-check-label" for="text-{{ model }}">{{ model }}</label>
                </div>
              {% endfor %}
            </div>

            <div class="mb-3">
              <label for="default_text_model" class="form-label">Default Text Model:</label>
              <select class="form-select" name="default_text_model" id="default_text_model">
                {% for model in all_text_models %}
                  <option value="{{ model }}" {% if model == config.default_text_model %}selected{% endif %}>{{ model }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>

        <!-- Image Models -->
        <div class="card mb-4">
          <div class="card-header">Image Model Settings</div>
          <div class="card-body">

            <div class="mb-3">
              <label class="form-label">Allowed Image Models:</label>
              {% for model in all_image_models %}
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" name="allowed_image_models"
                         value="{{ model }}" id="image-{{ model }}"
                         {% if model in config.allowed_image_models %}checked{% endif %}>
                  <label class="form-check-label" for="image-{{ model }}">{{ model }}</label>
                </div>
              {% endfor %}
            </div>

            <div class="mb-3">
              <label for="default_image_model" class="form-label">Default Image Model:</label>
              <select class="form-select" name="default_image_model" id="default_image_model">
                {% for model in all_image_models %}
                  <option value="{{ model }}" {% if model == config.default_image_model %}selected{% endif %}>{{ model }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>

        <!-- Upload Settings -->
        <div class="card mb-4">
          <div class="card-header">Upload Settings</div>
          <div class="card-body">

            <div class="mb-3">
              <label for="max_upload_size_mb" class="form-label">Max Upload File Size:</label>
              <select class="form-select" name="max_upload_size_mb" id="max_upload_size_mb">
                {% for size in [5,10,15,20,25,50] %}
                  <option value="{{ size }}" {% if size == config.max_upload_size_mb %}selected{% endif %}>{{ size }} MB</option>
                {% endfor %}
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">Allowed File Extensions (Text Analysis):</label>
              <input type="text" class="form-control" value="{{ allowed_file_exts }}" readonly>
            </div>

            <div class="mb-3">
              <label class="form-label">Allowed File Extensions (Image Analysis):</label>
              <input type="text" class="form-control" value="{{ image_exts }}" readonly>
            </div>
          </div>
        </div>

        <!-- Response Handling -->
        <div class="card mb-4">
          <div class="card-header">Response Handling</div>
          <div class="card-body">
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" name="enable_cache" id="enable_cache"
                     {% if config.enable_cache %}checked{% endif %}>
              <label class="form-check-label" for="enable_cache">Enable Cache</label>
            </div>

            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" name="enable_streaming" id="enable_streaming"
                     {% if config.enable_streaming %}checked{% endif %}>
              <label class="form-check-label" for="enable_streaming">Enable Streaming</label>
            </div>
          </div>
        </div>

        <!-- UI Behavior -->
        <div class="card mb-4">
          <div class="card-header">UI Behavior</div>
          <div class="card-body">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="lock_prompt_during_execution" id="lock_prompt_during_execution"
                     {% if config.lock_prompt_during_execution %}checked{% endif %}>
              <label class="form-check-label" for="lock_prompt_during_execution">Lock prompt input during model execution</label>
            </div>
          </div>
        </div>

        <div class="text-end">
          <button type="submit" class="btn btn-primary">üíæ Save Settings</button>
        </div>

      </form>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
